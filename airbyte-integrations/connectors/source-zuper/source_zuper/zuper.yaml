version: "0.1.0"

definitions:
  selector:
    type: RecordSelector
    extractor:
      type: DpathExtractor
      field_pointer: [ "data" ]
  requester:
    type: HttpRequester
    url_base: "https://us-west-1c.zuperpro.com/api"
    http_method: "GET"
    authenticator:
      type: ApiKeyAuthenticator
      header: "x-api-key"
      api_token: "{{ config['api_key'] }}"
  retriever:
    type: SimpleRetriever
    record_selector:
      $ref: "*ref(definitions.selector)"
    paginator:
      type: DefaultPaginator
      url_base: "*ref(definitions.requester.url_base)"
      page_size_option:
        inject_into: request_parameter
        field_name: limit
      pagination_strategy:
        type: PageIncrement
        page_size: 10
      page_token_option:
        inject_into: request_parameter
        field_name: page
    requester:
      $ref: "*ref(definitions.requester)"
  base_stream:
    type: DeclarativeStream
    retriever:
      $ref: "*ref(definitions.retriever)"
  assets_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "assets"
      primary_key: "asset_uid"
      path: "/assets"
  customers_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "customers"
      primary_key: "customer_uid"
      path: "/customers"
  invoices_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "invoices"
      primary_key: "invoice_uid"
      path: "/invoice"
  jobs_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "jobs"
      primary_key: "job_uid"
      path: "/jobs"
  organizations_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "organizations"
      primary_key: "organization_uid"
      path: "/organization"
  parts:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "parts"
      primary_key: "product_uid"
      path: "/product"
  part_transactions:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "part_transactions"
      primary_key: "transaction_uid"
      path: "/product/transaction"
  ppms_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "ppms"
      primary_key: "ppm_uid"
      path: "/ppm"
  properties_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "properties"
      primary_key: "property_uid"
      path: "/property"
  quotes_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "quotes"
      primary_key: "estimate_uid"
      path: "/estimate"
  routes_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "routes"
      primary_key: "route_uid"
      path: "/routes"
  service_contracts_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "service_contracts"
      primary_key: "contract_uid"
      path: "/service_contract"
  service_territories_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "service_territories"
      primary_key: "territory_uid"
      path: "/territory"
  teams_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "teams"
      primary_key: "team_uid"
      path: "/teams/summary"
  timesheets_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "timesheets"
      primary_key: "employee_timesheet_uid"
      path: "/timesheets"
  users_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "users"
      primary_key: "user_uid"
      path: "/user/all"
  webhooks_stream:
    $ref: "*ref(definitions.base_stream)"
    $options:
      name: "properties"
      primary_key: "property_uid"
      path: "/property"

streams:
  - "*ref(definitions.customers_stream)"
  - "*ref(definitions.jobs_stream)"

check:
  stream_names:
    - "customers"
    - "jobs"

spec:
  documentation_url: https://docs.airbyte.com/integrations/sources/braze
  connection_specification:
    $schema: http://json-schema.org/draft-07/schema#
    title: Zuper Spec
    type: object
    required:
      - api_key
    additionalProperties: true
    properties:
      api_key:
        type: string
        title: API Key
        description: API Key
        airbyte_secret: true
